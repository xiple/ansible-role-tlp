---
- name: Uninstall conflicting packages
  ansible.builtin.dnf:
    name: "{{ tlp_conflicting_package }}"
    state: absent

- name: Mask systemd-rfkill service and socket
  ansible.builtin.systemd:
    name: "{{ item }}"
    masked: true
    state: stopped
  loop:
    - systemd-rfkill.service
    - systemd-rfkill.socket

- name: Install tlp packages
  ansible.builtin.dnf:
    name: "{{ tlp_packages }}"
    state: present

- name: Make sure tlp service is started and enabled
  ansible.builtin.systemd_service:
    name: tlp
    state: started
    enabled: true
  when: tlp_service_manage | bool
